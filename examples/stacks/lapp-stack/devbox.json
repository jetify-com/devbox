{
  "packages": [
    "curl@8.0",
    "php@8.1",
    "php81Extensions.pgsql@latest",
    "apache@2.4",
    "postgresql@14"
  ],
  "env": {
    "PGHOST": "/tmp/devbox/lapp",
  },
  "shell": {
    "init_hook": [
      "test -r .devbox/ports || echo \"export PGPORT=$(devbox services free-port)\nexport HTTPD_PORT=$(devbox services free-port)\" > .devbox/ports",
      ". $PWD/.devbox/ports",
    ],
    "scripts": {
      "create_db": [
        "dropdb --if-exists devbox_lapp",
        "createdb devbox_lapp",
        "psql devbox_lapp < setup_postgres_db.sql"
      ],
      "init_db": "initdb",
      "run_test": [
        "mkdir -p /tmp/devbox/lapp", 
        "initdb",
        "devbox services up -b",
        "echo 'sleep 5 second for the postgres server to initialize.' && sleep 5",
        "cat .devbox/compose.log",
        "dropdb --if-exists devbox_lapp",
        "createdb devbox_lapp",
        "psql devbox_lapp < setup_postgres_db.sql",
        "curl localhost:$HTTPD_PORT",
        "devbox services stop"
      ]
    }
  }
}
