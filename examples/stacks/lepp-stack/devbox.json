{
  "packages": [
    "curl@latest",
    "postgresql@latest",
    "php@latest",
    "php83Extensions.pgsql@latest",
    "nginx@latest"
  ],
  "env": {
    "NGINX_WEB_PORT": "8089",
    "NGINX_WEB_ROOT": "../../../my_app",
    "PGPORT": "5433",
    "PGHOST": "/tmp/devbox/lepp"
  },
  "shell": {
    "scripts": {
      "create_db": [
        "dropdb --if-exists devbox_lepp",
        "createdb devbox_lepp",
        "psql devbox_lepp < setup_postgres_db.sql"
      ],
      "init_db": "initdb",
      "install": [
        "mkdir -p /tmp/devbox/lepp",
        "rm -rf .devbox/virtenv/postgresql/data",
        "initdb", 
        "devbox services up -b",
        "echo 'sleep 2 second for the postgres server to initialize.' && sleep 2",
        "devbox run create_db",
        "devbox services stop"
      ],
      "start": "devbox services up -b",
      "run_test": [
        "devbox run install",
        "devbox run start",
        "curl localhost:$NGINX_WEB_PORT",
        "devbox services stop"
      ]
    }
  }
}
