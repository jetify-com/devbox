# Testscript to validate generating the contents of the .envrc file.
# Note that since --envrc-dir was NOT specified, the .envrc will be in the `dir` directory and
# the config will be found there, which means the `--print-env` doesn't need to specify the dir.
# This matches the mode of operation prior to the addition of the --envrc-dir flag.

mkdir dir
exec devbox init dir
exists dir/devbox.json

exec devbox generate direnv --config dir
grep 'eval "\$\(devbox generate direnv --print-envrc\)"' dir/.envrc

cd dir
exec devbox generate direnv --print-envrc

cmp stdout ../expected-results.txt

# Note: The contents of the following file ends with two blank lines. This is
# necessary to match the blank line that follows "use devbox" in the actual output.
-- expected-results.txt --
use_devbox() {
    eval "$(devbox shellenv --init-hook --install --no-refresh-alias)"
    watch_file $DEVBOX_PROJECT_ROOT/devbox.json $DEVBOX_PROJECT_ROOT/devbox.lock
}
use devbox

