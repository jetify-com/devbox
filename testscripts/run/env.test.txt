exec devbox init

# Random vars should not leak into the run environment
env FOO=bar
exec devbox run echo '$FOO'
! stdout 'bar'

# Some vars (like HOME) should leak into the run environment
env HOME=/home/test
env USER=test-user
exec devbox run echo '$HOME'
stdout '/home/test'
exec devbox run echo '$USER'
stdout 'test-user'

# Fixed/hard-coded vars are set
exec devbox run echo '$NIX_PKGS_ALLOW_UNFREE'
stdout '1'
exec devbox run echo '$__ETC_PROFILE_NIX_SOURCED'
stdout '1'

# DEVBOX_* vars are passed through
env DEVBOX_FOO=baz
exec devbox run echo '$DEVBOX_FOO'
stdout 'baz'

# TODO: test order/overwriting of variables